!function(){let o,t,e;async function n(){$.ajax({url:"/api/estudiantes/all",dataType:"json",success:function(o){console.log(o);const t=$("#tablaEstudiantes").DataTable();t.clear(),t.rows.add(o),t.draw()},error:function(o,t,e){console.error(o.responseText)}})}$.ajax({url:"/api/estudiantes/all",dataType:"json",success:function(o){console.log(o);const t=$("#tablaEstudiantes").DataTable({data:o,columns:[{data:"Id"},{data:"Nombres"},{data:"Cod_estudiante"},{data:"usser"},{data:"Tutor_Nombres"},{data:null,render:function(o,t,e){return`\n                            <button type="button" class="btn btn-primary btn-editar" data-bs-toggle="modal" data-bs-target="#editarModal" data-id="${e.id}">Editar</button>\n                            <button type="button" class="btn btn-secondary btn-matriculas" data-bs-toggle="modal" data-bs-target="#modalMatriculasEstudiante" data-id="${e.Id}" >Matriculas</button>\n                            <button type="button" class="btn btn-danger btn-borrar" data-id="${e.Id}" data-tut="${e.Id_tutor}">Borrar</button>\n                                       `}}],language:{lengthMenu:"Mostrar _MENU_ registros por página",zeroRecords:"No se encontraron resultados",info:"Mostrando página _PAGE_ de _PAGES_",infoEmpty:"No hay registros disponibles",infoFiltered:"(filtrado de _MAX_ registros totales)",search:"Buscar:",loadingRecords:"Cargando...",processing:"Procesando...",emptyTable:"No hay datos disponibles en la tabla",aria:{sortAscending:": activar para ordenar la columna de manera ascendente",sortDescending:": activar para ordenar la columna de manera descendente"}}});$("#tablaEstudiantes tbody").on("click",".btn-editar",(function(){const o=t.row($(this).parents("tr")).data();$("#editId_estudiante").val(o.Id),$("#editId_datos_personales").val(o.Id_datos_personales),$("#editNombres").val(o.Nombres),$("#editApellidos").val(o.Apellidos),$("#editTelefono").val(o.Telefono),$("#editDireccion").val(o.Direccion),$("#editSexo").val(o.Id_sexo),$("#editCodEstudiante").val(o.Cod_estudiante),$("#editDepartamento").val(o.IdDepartamento),$("#editMunicipio").val(o.Id_Municipio)}))},error:function(o,t,e){console.error(o.responseText)}}),$.ajax({url:"/api/sexo/all",dataType:"json",success:function(t){o=t,console.log(t,"del sexo"),$("#sexo").empty(),t.forEach((function(o){$("#sexo").append('<option value="'+o.Id+'">'+o.Nombre+"</option>"),$("#editSexo").append('<option value="'+o.Id+'">'+o.Nombre+"</option>")}))},error:function(o){}}),$.ajax({url:"/api/departamentos/all",dataType:"json",success:function(o){console.log(o,"del departamento"),$("#Departamento").empty(),o.forEach((function(o){$("#Departamento").append('<option value="'+o.IdDepartamento+'">'+o.Nombre+"</option>"),$("#editDepartamento").append('<option value="'+o.IdDepartamento+'">'+o.Nombre+"</option>")}))},error:function(o){}}),$.ajax({url:"/api/municipios/all",dataType:"json",success:function(o){console.log(o,"del municipios"),$("#Municipio").empty(),o.forEach((function(o){$("#Municipio").append('<option value="'+o.IdMunicipio+'">'+o.Nombre+"</option>"),$("#editMunicipio").append('<option value="'+o.IdMunicipio+'">'+o.Nombre+"</option>")}))},error:function(o){}}),$.ajax({url:"/api/tutores/all",dataType:"json",success:function(o){console.log(o,"de los tutores"),e=o},error:function(o,t,e){console.error(o.responseText)}}),$("#tablaEstudiantes").on("click",".btn-matriculas",(function(){const o=$(this).data("id");console.log("eliminar el registro ID:",o),$.ajax({url:"/api/matricula-estudiante/all",type:"POST",data:{Id_Estudiante:o},dataType:"json",success:function(o){console.log(o),$("#gridmatriculas").empty(),o.forEach((function(o){$("#gridmatriculas").append(`\n                         <div class="col-3 mb-4">\n                            <div class="card">\n                                <div class="card-body">\n                                    <h5 class="card-title">${o.Id_anio_lectivo_anio}</h5>\n                                    <p class="card-text">${o.Id_grado_nombre} </p>\n                                    <p class="card-text">${o.Id_turno_nombre} </p>\n                                    <button type="button" data-matid="${o.Id}" class="btn btn-primary ver-boletinEst">Ver Boletin </button>\n                                </div>\n                            </div>\n                        </div>\n                        `)})),$(".ver-boletinEst").each((function(){$(this).on("click",(function(){const o=$(this).data("matid");$.ajax({url:"/api/reporte/boletin",type:"POST",data:{Id_matricula:o},success:function(o){console.log("Boletín:",o)},error:function(o,t,e){console.error("Error al obtener el boletín:",e)}})}))}))},error:function(o,t,e){console.error(o.responseText)}})})),$("#tablaEstudiantes").on("click",".btn-borrar",(function(){const o=$(this).data("id"),t=$(this).data("tut");console.log("eliminar el registro ID:",o),console.log("eliminar el registro IDTutor:",t),$.ajax({url:"/api/estudiantes/dell",type:"POST",data:{Id:o,Id_Tutor:t},dataType:"json",success:async function(o){console.log(o);if(o.exito)return await n(),void await Swal.fire({icon:"success",html:'<span style="font-size: 1.5rem; font-weight: 900;">Eliminado Correctamente</span>',toast:!0,position:"bottom-end",iconColor:"green",timer:1500,padding:"2rem",background:"#B8FFB8",showConfirmButton:!1})},error:function(o,t,e){console.error("Error:",e)}})})),$(document).ready((()=>{$('input[name="tutorExistente"]').change((function(){const n=$(this).val();$("#tutorchange").empty(),"2"===n?(t=2,console.log("Tutor existente seleccionado"),$("#tutorchange").append(" <form id='formTutorNuevo'>\n                <div class='mb-3'>\n                        <label for='nombresUsser' class='form-label'>Nombres</label>\n                        <input type='text' class='form-control' name='Nombres' id='nombresUsser'>\n                    </div>\n                    <div class='mb-3'>\n                        <label for='apellidosUsser' class='form-label'>Apellidos</label>\n                        <input type='text' class='form-control' name='Apellidos' id='apellidosUsser'>\n                    </div>\n                    <div class='mb-3'>\n                        <label for='Telefono' class='form-label'>Telefono</label>\n                        <input type='number' min=\"8\" max=\"9\" class='form-control' name='Telefono' id='Telefono'>\n                    </div>\n                    <div class='mb-3'>\n                        <label for='Cedula' class='form-label'>Cédula</label>\n                        <input type='text' class='form-control' name='Cedula' id='Cedula'>\n                    </div>\n                    <div class='mb-3'>\n                        <label for='Ocupacion' class='form-label'>Ocupación</label>\n                        <input type='text' class='form-control' name='Ocupacion' id='Ocupacion'>\n                    </div>\n                    <div class='mb-3'>\n                        <label for='Direccion' class='form-label'>Dirección</label>\n                        <textarea name='Direccion' id='Direccion' class='form-control'></textarea>\n                    </div>\n\n                    <div class='mb-3'>\n                        <label for='sexoTutor' class='form-label'>Sexo</label>\n                        <select class='form-select' name='Id_sexo' id='sexoTutor'>\n                        </select>\n                    </div>\n                </form>"),o.forEach((function(o){$("#sexoTutor").append('<option value="'+o.Id+'">'+o.Nombre+"</option>")}))):"1"===n&&(t=1,console.log("Nuevo tutor seleccionado"),$("#tutorchange").append("<form id='formTutorExistente'>\n\n                <div class='mb-3'>\n                        <label for='Tutor' class='form-label'>Tutor</label>\n                        <select class='form-select' name='Id_Tutor' id='Tutor'>\n                        </select>\n                    </div>\n\n\n                </form>"),e.forEach((function(o){$("#Tutor").append('<option value="'+o.Id+'">'+o.Nombres+" "+o.Apellidos+"</option>")})))})),$(document).ready((()=>{$("#GuardarEstudiante").click((async()=>{const o=new FormData($("#formAddDatosPersonales")[0]),t=new FormData($("#formEstudiante")[0]);function e(o){let t={};return o.forEach(((o,e)=>{t[e]=o})),t}const a=e(o),r=e(t),i={datos_personales:a,estudiante:r},s=/^\d{8,11}$/,l=/^\d{13}[A-Za-z]$/,d=$('input[name="Telefono"]'),c=$('input[name="Cedula"]');let u=!0;if(d.each((async function(){if(!s.test($(this).val()))return u=!1,await Swal.fire({icon:"error",html:'<span style="font-size: 1.5rem; font-weight: 800;">El celular debe tener de 8 a 12 dígitos</span>',toast:!0,position:"bottom-end",iconColor:"red",timer:1500,padding:"2rem",background:"rgb(255, 184, 184)",showConfirmButton:!1}),$(this).css("border","1px solid red"),!1;$(this).css("border","")})),c.each((async function(){if(!l.test($(this).val()))return u=!1,await Swal.fire({icon:"error",html:'<span style="font-size: 1.5rem; font-weight: 800;">La cédula está mal formateada</span>',toast:!0,position:"bottom-end",iconColor:"red",timer:1500,padding:"2rem",background:"rgb(255, 184, 184)",showConfirmButton:!1}),$(this).css("border","1px solid red"),!1;$(this).css("border","")})),!u)return;const m=$("input[name='tutorExistente']:checked").val();if(m)if(m){if(1==m){const o=e(new FormData($("#formTutorExistente")[0]));i.TutorExistente=o,delete i.TutorNuevo}else{const o=e(new FormData($("#formTutorNuevo")[0]));i.TutorNuevo=o,delete i.TutorExistente}p(a)&&p(r)&&(1!=m||p(i.TutorExistente))&&(1==m||p(i.TutorNuevo))?($.ajax({url:"/api/estudiantes/add",dataType:"json",type:"POST",data:i,success:async function(o){if(console.log(o,"del back"),!o.alert)return o.exito?(await n(),$("#formAddDatosPersonales")[0].reset(),$("#formEstudiante")[0].reset(),1!=m&&$("#formTutorNuevo")[0].reset(),$("#tutorchange").empty(),$('input[name="tutorExistente"]').prop("checked",!1),$("#agregarModal").modal("hide"),void await Swal.fire({icon:"success",html:`<span style="font-size: 1.5rem; font-weight: 900;">${o.exito}</span>`,toast:!0,position:"bottom-end",iconColor:"green",timer:1500,padding:"2rem",background:"#B8FFB8",showConfirmButton:!1})):void(o.error&&await Swal.fire({icon:"error",html:`<span style="font-size: 1.5rem; font-weight: 900;">${o.error}</span>`,toast:!0,position:"bottom-end",iconColor:"red",timer:1500,padding:"2rem",background:"#FFB8B8",showConfirmButton:!1}));await Swal.fire({icon:"warning",html:`<span style="font-size: 1.5rem; font-weight: 900;">${o.alert}</span>`,toast:!0,position:"bottom-end",iconColor:"red",timer:1500,padding:"2rem",background:"#FFFFB8",showConfirmButton:!1})},error:function(o){}}),console.log(i)):await Swal.fire({icon:"error",html:'<span style="font-size: 1.5rem; font-weight: 900;">Todos los campos son obligatorios</span>',toast:!0,position:"bottom-end",iconColor:"red",timer:1500,padding:"2rem",background:"rgb(255, 199, 199)",showConfirmButton:!1})}else await Swal.fire({icon:"error",html:'<span style="font-size: 1.5rem; font-weight: 800;">Debe seleccionar una opción para el tutor</span>',toast:!0,position:"bottom-end",iconColor:"red",timer:1500,padding:"2rem",background:"rgb(255, 184, 184)",showConfirmButton:!1});else await Swal.fire({icon:"error",html:'<span style="font-size: 1.5rem; font-weight: 800;">Debe seleccionar una opción para el tutor</span>',toast:!0,position:"bottom-end",iconColor:"red",timer:1500,padding:"2rem",background:"rgb(255, 184, 184)",showConfirmButton:!1});function p(o){for(let t in o)if(""===o[t].trim())return!1;return!0}})),$("#GuardarCambiosEstudiante").click((async function(){const o=new FormData($("#formEditEstudiante")[0]),t=/^\d{8,11}$/,e=$("#editTelefono");let a=!0;const r=function(o){let t={};return o.forEach(((o,e)=>{t[e]=o})),t}(o);e.each((async function(){if(!t.test($(this).val()))return a=!1,await Swal.fire({icon:"error",html:'<span style="font-size: 1.5rem; font-weight: 800;">El celular debe tener de 8 a 12 dígitos</span>',toast:!0,position:"bottom-end",iconColor:"red",timer:1500,padding:"2rem",background:"rgb(255, 184, 184)",showConfirmButton:!1}),$(this).css("border","1px solid red"),!1;$(this).css("border","")})),a&&$.ajax({url:"/api/estudiantes/edit",method:"POST",dataType:"json",data:r,success:async function(o){if(console.log(o),o.exito)return await n(),$("#formEditEstudiante")[0].reset(),$("#editarModal").modal("hide"),void await Swal.fire({icon:"success",html:`<span style="font-size: 1.5rem; font-weight: 900;">${o.exito}</span>`,toast:!0,position:"bottom-end",iconColor:"green",timer:1500,padding:"2rem",background:"#B8FFB8",showConfirmButton:!1})},error:function(o,t,e){console.error(o.responseText)}})}))}))}))}();//# sourceMappingURL=tablaestudiantes.js.map
